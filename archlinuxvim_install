#!/bin/bash

if [ $1 = '' ]; 
	then echo -e "Usage: archlinuxvim_install /dev/targetdevice \n\nFor example:\n# archlinuxvim_install /dev/sdc\n"; 
	exit -1;
fi

device=$1
if ls $device >/dev/null 2>&1; 
	then echo -e; 
	else echo 'Target device not found!';
	exit -2;
fi;

echo 'Target device is '$device

#dd if=/dev/zero of=$device bs=512 count=1 # Remove MBR
#
#(
#echo o		# Create a new empty DOS partition table
#echo n		# Create a new partotion
#echo p		# Primary partition
#echo 1		# Number 1 for FAT
#echo		# Default begin sector
#echo +256M	# Size of FAT partition
#echo n		# New part
#echo p		# Primary
#echo 2		# Number 2 for rootfs
#echo		# begin sector is default
#echo		# end   sector is default
#echo w		# write MBR
#) | fdisk $device

ROOT=/mnt/archlinuxvim/root
mkdir -p $ROOT
mount $device'2' $ROOT 
echo 'Download ArchLinux core filesystem to target...'
wget -c -P $ROOT http://os.archlinuxarm.org/os/ArchLinuxARM-odroid-n2-latest.tar.gz
echo 'Unpackaging...'
tar -xvf $ROOT/ArchLinuxARM-odroid-n2-latest.tar.gz -C $ROOT
#rm $ROOT/ArchLinuxARM-odroid-n2-latest.tar.gz

dev=`echo $device | cut -d / -f 3`
rootdev_uuid=`ls -l /dev/disk/by-uuid/ |grep $dev | cut -d ' ' -f 10`

echo 'UUID of root device is '$rootdev_uuid

cp etc/fstab $ROOT/etc/

wget -c -P $ROOT 





#umount $ROOT 
#rm -rf /mnt/archlinuxvim/



